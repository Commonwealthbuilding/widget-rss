<!-- 4x1 Layout -->
<template id="layout">
  <div id="layout-4x1">
    <article class="item hide">
      <img class="image" />
      <div class="textWrapper">
        <h1 class="headline headline_font-style">
          <a class="headline_font-style" target="_blank"></a>
        </h1>
        <div class="meta">
          <span class="timestamp timestamp_font-style"></span>
          <span class="separator">-</span>
          <span class="author author_font-style"></span>
        </div>
        <p class="story story_font-style"></p>
      </div>
    </article>
  </div>
</template>
<style>

  
/* =========================================================================
   CSS Reset
   ========================================================================== */

/*! normalize.css v3.0.1 | MIT License | git.io/normalize */

/**
 * 1. Set default font family to sans-serif.
 * 2. Prevent iOS text size adjust after orientation change,
 *    without disabling user zoom.
 */

html {
  /* Visual */
  font-family: sans-serif; /* 1 */
  -ms-text-size-adjust: 100%; /* 2 */
  -webkit-text-size-adjust: 100%; /* 2 */
    vertical-align: middle; 
}

/**
 * Remove default margin.
 */
body, p {
  /* Display & Box Model */
  margin: 0;
  padding: 0;
   vertical-align: middle;   
}

/* =========================================================================
Custom Styling
========================================================================== */

body {
  /* Visual */
  background-color: transparent;
    vertical-align: middle;   
}

.headline,
.story,
.timestamp,
.author {
  margin: 0;
  padding: 10px;
    vertical-align: middle; 
}

.author, .timestamp {
  display: inline-block;
    vertical-align: middle; 
}

.image {
  max-width: 100%;
  max-height: 100%;
  margin: 0px;
  padding: 0px;
    vertical-align: middle; 
}

.item {
  overflow: hidden;
    vertical-align: middle; 
}

.custom-font {
  visibility: hidden;
    vertical-align: middle; 
}

.fade-in, .fade-out {
  -webkit-transition: opacity 1s;
  transition: opacity 1s;
}

.fade-out, .hide {
  opacity: 0;
}

.fade-in {
  opacity: 1;
}

#container {
  width: 100%;
  height: 100%;
    vertical-align: middle; 
}

#messageContainer .error-link {
  color: blue;
    vertical-align: middle; 
}

#scroller {
  display: none;
    vertical-align: middle; 
}

#layout-4x1 .textWrapper {
  overflow: hidden;
    vertical-align: middle;   
}

#layout-2x1 .item {
  clear: left;
    vertical-align: middle;   
}

#layout-2x1 .story {
  overflow: hidden;
    vertical-align: middle;   
}

#layout-4x1 .image,
#layout-2x1 .image {
  float: left;
    vertical-align: middle;   
}

#layout-16x9 .image {
  display: block;
    vertical-align: middle;   
}


</style>
<script>
angular.module( "risevision.widget.rss.settings" )
  .controller( "rssSettingsController", [ "$scope", "$log", "feedValidator",
    function( $scope, $log, feedValidator ) {

      function isHorizontalConfigured() {
        return $scope.settings.additionalParams.transition.direction === "left" &&
          $scope.settings.additionalParams.transition.type === "scroll";
      }

      $scope.feedValid = true;
      $scope.requiresAuthentication = false;
      $scope.notAFeed = false;
      $scope.horizontalScrolling = false;

      $scope.validateFeed = function() {
        feedValidator.isValid( $scope.settings.additionalParams.url ).then( function( value ) {
          $scope.feedValid = value;
        } );
      };

      $scope.checkWithFeedParser = function() {
        if ( $scope.settings.additionalParams.url && $scope.settingsForm.rssUrl.$valid ) {
          feedValidator.isParsable( $scope.settings.additionalParams.url )
            .then( function( value ) {
              if ( value === "401 Unauthorized" ) {
                $scope.requiresAuthentication = true;
              } else if ( value === "Not a feed" ) {
                $scope.notAFeed = true;
              }
              if ( !value ) {
                $scope.requiresAuthentication = false;
                $scope.notAFeed = false;
                $scope.validateFeed();
              }
            } );
        } else {
          $scope.requiresAuthentication = false;
          $scope.notAFeed = false;
          $scope.feedValid = true;
        }
      };

      $scope.$on( "urlFieldBlur", function() {
        $scope.checkWithFeedParser();
      } );

      $scope.$watch( "settings.additionalParams.url", function( newVal, oldVal ) {
        if ( typeof oldVal === "undefined" && newVal && newVal !== "" ) {
          // previously saved settings are being shown
          $scope.checkWithFeedParser();
        } else {
          if ( typeof newVal !== "undefined" ) {
            // ensure warning message doesn't get shown while url field is receiving input
            $scope.feedValid = true;
            $scope.requiresAuthentication = false;
          }
        }

      } );

      $scope.$watch( "settings.additionalParams.transition.type", function( value ) {
        if ( typeof value !== "undefined" ) {
          $scope.horizontalScrolling = isHorizontalConfigured();
        }
      } );

      $scope.$watch( "settings.additionalParams.transition.direction", function( value ) {
        if ( typeof value !== "undefined" ) {
          $scope.horizontalScrolling = isHorizontalConfigured();
        }
      } );

      $scope.$watch( "settings.additionalParams.dataSelection.showTitle", function( value ) {
        if ( typeof value !== "undefined" && value !== "" && !value ) {
          $scope.settings.additionalParams.headline.fontStyle = {};
        }
      } );

      $scope.$watch( "settings.additionalParams.dataSelection.showTimestamp", function( value ) {
        if ( typeof value !== "undefined" && value !== "" && !value ) {
          $scope.settings.additionalParams.timestamp.fontStyle = {};
        }
      } );

      $scope.$watch( "settings.additionalParams.dataSelection.showAuthor", function( value ) {
        if ( typeof value !== "undefined" && value !== "" && !value ) {
          $scope.settings.additionalParams.author.fontStyle = {};
        }
      } );

      $scope.$watch( "settings.additionalParams.dataSelection.showDescription", function( value ) {
        if ( typeof value !== "undefined" && value !== "snippet" ) {
          if ( $scope.settings.additionalParams.dataSelection.snippetLength ) {
            $scope.settings.additionalParams.dataSelection.snippetLength = $scope.settings.additionalParams.dataSelection.snippetLength;
          } else {
            $scope.settings.additionalParams.dataSelection.snippetLength = 120;
          }
        }
      } );

    } ] )
  .filter( "escape", function() {
    return window.encodeURIComponent;
  } )
  .value( "defaultSettings", {
    "params": {},
    "additionalParams": {
      "url": "",
      "itemsInQueue": 5,
      "itemsToShow": 1,
      "headline": {
        "fontStyle": {
          "font": {
            "family": "verdana,geneva,sans-serif",
            "type": "standard",
            "url": ""
          },
          "size": "24px",
            "vertical-align": "middle",
          "customSize": "",
          "align": "left",
          "bold": true,
          "italic": false,
          "underline": false,
          "forecolor": "black",
          "backcolor": "transparent"
        }
      },
      "story": {
        "vertical-align":"middle",
        "fontStyle": {
          "font": {
            "family": "verdana,geneva,sans-serif",
            "type": "standard",
            "url": ""
          },
          "size": "18px",
          "customSize": "",
          "align": "left",
          "vertical-align": "middle", 
          "bold": true,
          "italic": false,
          "underline": false,
          "forecolor": "black",
          "backcolor": "transparent"
        }
      },
      "timestamp": {
        "fontStyle": {
          "font": {
            "family": "verdana,geneva,sans-serif",
            "type": "standard",
            "url": ""
          },
          "size": "14px",
          "customSize": "",
          "align": "left",
          "bold": true,
          "italic": false,
          "underline": false,
          "forecolor": "#969696",
          "backcolor": "transparent"
        }
      },
      "author": {
        "fontStyle": {
          "font": {
            "family": "verdana,geneva,sans-serif",
            "type": "standard",
            "url": ""
          },
          "size": "14px",
          "customSize": "",
          "align": "left",
          "bold": true,
          "italic": false,
          "underline": false,
          "forecolor": "#969696",
          "backcolor": "transparent",
          "vertical-align":"middle",
        }
      },
      "transition": {},
      "dataSelection": {
        "showTitle": true,
        "showTimestamp": true,
        "showAuthor": true,
        "showImage": true,
        "showDescription": "snippet",
        "snippetLength": 120
      },
      "layout": "layout-4x1",
      "layoutUrl": "",
      "separator": {
        "show": true,
        "size": 1,
        "color": "rgb(238,238,238)"
      }
    }
  } );
